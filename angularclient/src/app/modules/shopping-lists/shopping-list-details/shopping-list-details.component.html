<ng-container *ngIf="loadingService.loading$ | async">
  <app-loading-spinner></app-loading-spinner>
</ng-container>
<div
  *ngIf="!(loadingService.loading$ | async)"
  class="card shopping-list"
  [ngClass]="{ 'shopping-list-done': shoppingList?.isDone }"
>
  <div
    class="card-header"
    [ngClass]="{ 'shopping-list-done': shoppingList?.isDone }"
  >
    <h3 class="card-title">{{ shoppingList?.name }}</h3>
    <div
      *ngIf="
        !shoppingListProductNamesSelected ||
          shoppingListProductNamesSelected.length == 0;
        then headerPopup;
        else multipleSelectHeader
      "
    ></div>
    <ng-template #headerPopup>
      <app-popup-menu [popupMenuConfig]="headerPopupMenuConfig"></app-popup-menu
    ></ng-template>
    <ng-template #multipleSelectHeader>
      <app-popup-menu
        [popupMenuConfig]="multipleItemsSelectedPopupMenuConfig"
      ></app-popup-menu
    ></ng-template>
  </div>
  <ul class="list-group list-group-flush shopping-list__products">
    <li *ngFor="let product of shoppingList?.products">
      <app-shopping-list-product
        #product
        class="single-product"
        [shoppingListProduct]="product"
        [shoppingListId]="shoppingListId"
        [isDone]="shoppingList!.isDone"
      ></app-shopping-list-product>
    </li>
  </ul>
  <div
    class="card-footer"
    [ngClass]="{ 'shopping-list-done': shoppingList?.isDone }"
  >
    <h5>
      {{ shoppingList?.createdByFirstName }}
      {{ shoppingList?.createdByLastName }}
    </h5>
    <h5>Total price:</h5>
    <h5>
      {{ shoppingList?.countBoughtProducts() }} /
      {{ shoppingList?.products?.length }} products bought
    </h5>
    <h5>{{ shoppingList?.countTotalPrice() }} z≈Ç</h5>
  </div>
</div>

<app-add-shopping-list-product
  [shoppingListId]="shoppingListId"
  #addShoppingListProductForm
></app-add-shopping-list-product>

<app-confirmation-modal
  [confirmationModalConfig]="markAsDoneModalConfig"
  #markAsDoneModal
>
</app-confirmation-modal>

<app-confirmation-modal
  [confirmationModalConfig]="markAsUndoneModalConfig"
  #markAsUndoneModal
>
</app-confirmation-modal>

<app-confirmation-modal
  [confirmationModalConfig]="deleteShoppingListModalConfig"
  #deleteShoppingList
></app-confirmation-modal>

<app-edit-shopping-list-modal
  #editShoppingListModal
  [shoppingList]="shoppingList!"
  [isSingleRefresh]="true"
></app-edit-shopping-list-modal>

<app-confirmation-modal
  [confirmationModalConfig]="deleteSelectedProductsModalConfig"
  #deleteSelectedProductsModal
>
</app-confirmation-modal>

<app-purchase-shopping-list-products-modal
  #purchaseShoppingListProductsModal
  [shoppingListId]="shoppingListId"
  [shoppingListProductNames]="shoppingListProductNamesSelected"
></app-purchase-shopping-list-products-modal>
